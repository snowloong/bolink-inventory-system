# @bolink-inventory-system/safety - 安全管理模块

## 模块概述
安全管理模块专门针对新能源电池的安全特性，负责从仓储、运输到操作全过程的安全管理，确保符合危险品管理法规，预防安全事故发生。

## 核心功能

### 1. 仓储安全管理

#### 1.1 环境监控系统
- **温度监控**：实时监控仓库环境温度
- **湿度监控**：控制仓库湿度在安全范围内
- **烟雾监测**：安装烟雾传感器预警火灾
- **气体监测**：监测有害气体浓度
- **24小时监控**：全天候环境参数监控

#### 1.2 消防安全系统
- **自动灭火系统**：自动喷淋、气体灭火系统
- **消防设备管理**：灭火器、消防栓、防火门
- **防火分区管理**：仓库防火分区规划和管理
- **疏散通道管理**：应急疏散通道标识和维护
- **消防演练**：定期消防演练和培训

#### 1.3 电气安全管理
- **防爆电气设备**：使用防爆等级电气设备
- **静电防护**：静电消除和防护措施
- **接地系统**：完善的防雷接地系统
- **电气检查**：定期电气安全检查
- **应急断电**：应急情况快速断电系统

#### 1.4 通风系统管理
- **强制通风**：机械通风系统管理
- **自然通风**：自然通风系统优化
- **排风系统**：有害气体排风系统
- **空气质量监测**：室内空气质量监测
- **通风设备维护**：通风设备定期维护

### 2. 运输安全管理

#### 2.1 危险品运输规范
- **UN38.3认证**：确保电池通过UN38.3测试
- **危险品标识**：正确的危险品标识和标签
- **包装要求**：符合危险品包装标准
- **运输文件**：完整的危险品运输文件
- **承运商资质**：验证承运商危险品运输资质

#### 2.2 包装安全要求
- **包装材料标准**：使用符合标准的包装材料
- **包装设计要求**：防短路、防挤压包装设计
- **包装检验**：包装完整性检验
- **标识要求**：清晰的产品和危险品标识
- **包装记录**：包装过程记录和追溯

#### 2.3 运输路线安全评估
- **路线规划**：选择安全的运输路线
- **禁行时段**：遵守危险品运输禁行规定
- **应急停靠点**：规划应急停靠和处置点
- **路况监控**：实时路况监控和调整
- **运输跟踪**：全程GPS跟踪运输车辆

#### 2.4 运输应急预案
- **事故应急处理**：运输事故应急处理预案
- **应急联系网络**：建立应急联系网络
- **应急物资配备**：运输车辆应急物资配备
- **应急培训**：驾驶员应急处理培训
- **事故报告**：事故报告和调查程序

### 3. 合规管理

#### 3.1 法规遵循管理
- **国家法规**：遵循危险化学品相关法规
- **地方法规**：遵循地方安全管理规定
- **行业标准**：遵循电池行业安全标准
- **国际标准**：遵循国际运输安全标准
- **法规更新跟踪**：及时跟踪法规更新变化

#### 3.2 资质证照管理
- **危险品经营许可证**：危险品经营许可证管理
- **安全生产许可证**：安全生产许可证管理
- **环保资质**：环保相关资质管理
- **运输资质**：危险品运输资质管理
- **人员资质**：特种作业人员资质管理

#### 3.3 环保要求管理
- **废料处置**：废旧电池环保处置
- **污染防治**：环境污染防治措施
- **环境监测**：定期环境影响监测
- **排放管理**：废气废水排放管理
- **环保报告**：环保合规报告

#### 3.4 安全认证管理
- **ISO45001认证**：职业健康安全管理体系
- **安全标准化**：安全生产标准化认证
- **第三方认证**：其他安全相关认证
- **认证维护**：认证的维护和更新
- **审核配合**：配合各类安全审核

### 4. 应急处理

#### 4.1 应急预案体系
- **综合应急预案**：全面的应急预案体系
- **专项应急预案**：针对具体风险的专项预案
- **现场处置方案**：具体岗位的现场处置方案
- **预案演练**：定期应急预案演练
- **预案更新**：根据实际情况更新预案

#### 4.2 应急组织管理
- **应急指挥部**：应急事故指挥组织
- **应急小组**：各专业应急处理小组
- **外部联系**：与外部应急机构的联系
- **应急培训**：应急人员专业培训
- **轮班制度**：24小时应急值班制度

#### 4.3 应急物资管理
- **应急设备**：应急处置专用设备
- **防护用品**：个人防护用品储备
- **医疗用品**：急救医疗用品储备
- **通讯设备**：应急通讯设备
- **物资检查**：定期检查应急物资状态

#### 4.4 事故处理流程
- **事故报告**：事故第一时间报告机制
- **现场处置**：事故现场处置措施
- **人员救援**：人员疏散和医疗救援
- **事故调查**：事故原因调查分析
- **整改措施**：事故整改和预防措施

## 数据模型设计

### 安全检查记录表 (safety_inspections)
```sql
- id: 主键
- inspection_code: 检查编号
- inspection_type: 检查类型
- inspection_area: 检查区域
- inspection_date: 检查日期
- inspector: 检查人
- inspection_items: 检查项目(JSON)
- findings: 检查发现(JSON)
- risk_level: 风险等级
- corrective_actions: 纠正措施
- completion_date: 完成日期
- status: 状态
- created_at: 创建时间
```

### 环境监控记录表 (environment_monitoring)
```sql
- id: 主键
- warehouse_id: 仓库ID
- monitoring_date: 监控日期
- temperature: 温度
- humidity: 湿度
- air_quality: 空气质量
- smoke_level: 烟雾浓度
- gas_concentration: 气体浓度
- alarm_triggered: 是否触发报警
- alarm_type: 报警类型
- handling_record: 处理记录
- created_at: 记录时间
```

### 危险品运输记录表 (hazmat_shipments)
```sql
- id: 主键
- shipment_code: 运输单号
- product_id: 产品ID
- quantity: 数量
- packaging_type: 包装类型
- un_number: UN编号
- hazard_class: 危险品类别
- carrier_id: 承运商ID
- driver_license: 驾驶员证件
- route_plan: 运输路线
- departure_time: 出发时间
- arrival_time: 到达时间
- status: 运输状态
- created_at: 创建时间
```

### 应急事件记录表 (emergency_incidents)
```sql
- id: 主键
- incident_code: 事件编号
- incident_type: 事件类型
- incident_level: 事件等级
- incident_date: 发生日期
- location: 发生地点
- description: 事件描述
- cause_analysis: 原因分析
- response_actions: 应对措施
- personnel_involved: 涉及人员
- damage_assessment: 损失评估
- lessons_learned: 经验教训
- corrective_measures: 纠正措施
- status: 处理状态
- created_at: 创建时间
```

### 安全培训记录表 (safety_training)
```sql
- id: 主键
- training_code: 培训编号
- training_topic: 培训主题
- training_date: 培训日期
- trainer: 培训师
- attendees: 参训人员(JSON)
- training_content: 培训内容
- training_materials: 培训资料
- assessment_results: 考核结果(JSON)
- effectiveness_evaluation: 效果评价
- follow_up_actions: 后续行动
- created_at: 创建时间
```

### 安全资质证照表 (safety_certificates)
```sql
- id: 主键
- certificate_type: 证照类型
- certificate_number: 证照编号
- issuing_authority: 发证机关
- issue_date: 发证日期
- expiry_date: 到期日期
- scope: 适用范围
- status: 状态
- renewal_reminder: 续证提醒
- related_documents: 相关文件
- responsible_person: 负责人
- created_at: 创建时间
```

## 接口设计

### 安全检查接口
**统一接口**：`POST /api/safety/inspections`

**参数说明**：`action` - 操作类型，详见 SafetyInspectionAction 类型定义

#### Action字典说明
```typescript
export type SafetyInspectionAction = 
  // 基础CRUD操作
  | 'create'    // 创建安全检查
  | 'list'      // 查询检查列表
  | 'detail'    // 获取检查详情
  | 'update'    // 更新检查信息
  | 'delete'    // 删除检查记录
  
  // 检查流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交检查
  | 'approve'   // 审批检查结果
  | 'reject'    // 检查拒绝
  | 'complete'  // 完成检查
  | 'cancel'    // 取消检查
  
  // 检查查询
  | 'by-warehouse' // 按仓库查询检查
  | 'by-type'     // 按类型查询检查
  | 'by-risk-level' // 按风险等级查询
  | 'by-date'     // 按日期查询检查
  
  // 检查操作
  | 'inspect'   // 执行检查
  | 'record'    // 记录结果
  | 'assess'    // 风险评估
  | 'correct'   // 纠正措施
  
  // 统计分析
  | 'statistics' // 检查统计分析
  | 'trends'     // 检查趋势分析
  | 'risk-analysis' // 风险分析
  
  // 数据管理
  | 'export'     // 检查数据导出
  | 'import'     // 检查数据导入;
```

#### 不同action的请求示例
```json
// 创建安全检查
{
  "action": "create",
  "data": {
    "inspection_type": "routine",
    "inspection_area": "warehouse_a",
    "inspection_date": "2024-03-25",
    "inspector": 101,
    "inspection_items": [
      "fire_safety",
      "electrical_safety",
      "environmental_monitoring"
    ]
  }
}

// 完成检查
{
  "action": "complete",
  "data": {
    "inspection_id": 123,
    "findings": {
      "fire_safety": "正常",
      "electrical_safety": "需要维护",
      "environmental_monitoring": "正常"
    },
    "risk_level": "medium",
    "corrective_actions": "安排电气设备维护"
  }
}

// 按仓库查询检查
{
  "action": "by-warehouse",
  "params": {
    "warehouse_id": 456,
    "start_date": "2024-03-01",
    "end_date": "2024-03-31"
  }
}

// 检查统计分析
{
  "action": "statistics",
  "params": {
    "period": "2024-Q1",
    "warehouse_id": 456,
    "analysis_type": "risk_distribution"
  }
}
```

### 环境监控接口
**统一接口**：`POST /api/safety/monitoring`

**参数说明**：`action` - 操作类型，详见 EnvironmentMonitoringAction 类型定义

#### Action字典说明
```typescript
export type EnvironmentMonitoringAction = 
  // 基础CRUD操作
  | 'create'    // 创建环境监控记录
  | 'list'      // 查询监控列表
  | 'detail'    // 获取监控详情
  | 'update'    // 更新监控信息
  | 'delete'    // 删除监控记录
  
  // 监控查询
  | 'by-warehouse' // 按仓库查询监控
  | 'by-date'     // 按日期查询监控
  | 'by-alert'    // 按警报查询监控
  
  // 警报管理
  | 'alerts'    // 环境警报查询
  | 'handle-alert' // 警报处理
  | 'acknowledge' // 确认警报
  | 'escalate'  // 警报升级
  
  // 设备管理
  | 'equipment' // 设备状态查询
  | 'maintain'  // 设备维护
  | 'calibrate' // 设备校准
  | 'replace'   // 设备更换
  
  // 趋势分析
  | 'trends'    // 环境趋势分析
  | 'forecast'  // 环境预测
  | 'anomaly'   // 异常检测
  
  // 数据管理
  | 'export'     // 监控数据导出
  | 'backup'     // 数据备份;
```

#### 不同action的请求示例
```json
// 创建环境监控记录
{
  "action": "create",
  "data": {
    "warehouse_id": 123,
    "temperature": 25.5,
    "humidity": 45.2,
    "air_quality": "good",
    "smoke_level": 0.01,
    "gas_concentration": 0.005
  }
}

// 警报处理
{
  "action": "handle-alert",
  "data": {
    "alert_id": 789,
    "alert_type": "temperature_high",
    "handling_action": "启动制冷系统",
    "handled_by": 101
  }
}

// 设备维护
{
  "action": "maintain",
  "data": {
    "equipment_id": 456,
    "maintenance_type": "preventive",
    "maintenance_date": "2024-03-25",
    "technician": 102,
    "description": "传感器校准"
  }
}

// 环境趋势分析
{
  "action": "trends",
  "params": {
    "warehouse_id": 123,
    "parameter": "temperature",
    "period": "7days"
  }
}
```

### 危险品运输接口
**统一接口**：`POST /api/safety/hazmat-shipments`

**参数说明**：`action` - 操作类型，详见 HazmatShipmentAction 类型定义

#### Action字典说明
```typescript
export type HazmatShipmentAction = 
  // 基础CRUD操作
  | 'create'    // 创建危险品运输
  | 'list'      // 查询运输列表
  | 'detail'    // 获取运输详情
  | 'update'    // 更新运输信息
  | 'delete'    // 删除运输记录
  
  // 运输流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交申请
  | 'approve'   // 审批运输申请
  | 'reject'    // 申请拒绝
  | 'start'     // 开始运输
  | 'complete'  // 完成运输
  | 'cancel'    // 取消运输
  
  // 运输跟踪
  | 'tracking'  // 运输跟踪
  | 'location'  // 位置更新
  | 'status'    // 状态更新
  
  // 包装管理
  | 'packaging' // 包装检查
  | 'certify'   // 包装认证
  | 'validate'  // 包装验证
  
  // 统计分析
  | 'statistics' // 运输统计分析
  | 'compliance' // 合规性分析
  
  // 数据管理
  | 'export'     // 运输数据导出;
```

#### 不同action的请求示例
```json
// 创建危险品运输
{
  "action": "create",
  "data": {
    "product_id": 123,
    "quantity": 500,
    "packaging_type": "un3480",
    "un_number": "UN3480",
    "hazard_class": "9",
    "carrier_id": 456,
    "route_plan": "深圳-广州-上海"
  }
}

// 审批运输申请
{
  "action": "approve",
  "data": {
    "shipment_id": 789,
    "approved_by": 101,
    "approval_conditions": "夜间运输，避开禁行时段"
  }
}

// 运输跟踪
{
  "action": "tracking",
  "params": {
    "shipment_id": 789
  }
}

// 开始运输
{
  "action": "start",
  "data": {
    "shipment_id": 789,
    "departure_time": "2024-03-25T10:00:00Z",
    "driver_id": 102
  }
}
```

### 安全事故接口
**统一接口**：`POST /api/safety/incidents`

**参数说明**：`action` - 操作类型，详见 SafetyIncidentAction 类型定义

#### Action字典说明
```typescript
export type SafetyIncidentAction = 
  // 基础CRUD操作
  | 'create'    // 创建安全事故记录
  | 'list'      // 查询事故列表
  | 'detail'    // 获取事故详情
  | 'update'    // 更新事故信息
  | 'delete'    // 删除事故记录
  
  // 事故流程
  | 'report'    // 报告安全事故
  | 'escalate'  // 事件升级
  | 'investigate' // 事故调查
  | 'resolve'   // 事故解决
  | 'close'     // 关闭事故
  
  // 应急响应
  | 'response-team' // 应急响应团队
  | 'communication' // 应急通信
  | 'evacuation' // 人员疏散
  | 'first-aid' // 急救处理
  
  // 分析处理
  | 'cause-analysis' // 原因分析
  | 'lessons-learned' // 经验教训
  | 'prevention' // 预防措施
  | 'improvement' // 改进措施
  
  // 统计分析
  | 'statistics' // 事件统计分析
  | 'trends'     // 事件趋势分析
  
  // 数据管理
  | 'export'     // 事故数据导出;
```

#### 不同action的请求示例
```json
// 创建安全事故记录
{
  "action": "create",
  "data": {
    "incident_type": "fire",
    "incident_level": "moderate",
    "location": "warehouse_b",
    "description": "电气设备短路引发小火",
    "discovered_by": 101
  }
}

// 报告安全事故
{
  "action": "report",
  "data": {
    "incident_id": 123,
    "reported_to": "safety_manager",
    "report_time": "2024-03-25T14:30:00Z",
    "immediate_actions": "启动灭火系统，疏散人员"
  }
}

// 事故调查
{
  "action": "investigate",
  "data": {
    "incident_id": 123,
    "investigator": 102,
    "investigation_method": "root_cause_analysis",
    "findings": "设备老化导致短路"
  }
}

// 经验教训
{
  "action": "lessons-learned",
  "data": {
    "incident_id": 123,
    "lessons": "加强设备定期检查",
    "preventive_measures": "建立设备维护计划"
  }
}
```

### 安全培训接口
**统一接口**：`POST /api/safety/training`

**参数说明**：`action` - 操作类型，详见 SafetyTrainingAction 类型定义

#### Action字典说明
```typescript
export type SafetyTrainingAction = 
  // 基础CRUD操作
  | 'create'    // 创建安全培训
  | 'list'      // 查询培训列表
  | 'detail'    // 获取培训详情
  | 'update'    // 更新培训信息
  | 'delete'    // 删除培训记录
  
  // 培训流程
  | 'plan'      // 培训计划
  | 'schedule'  // 安排培训
  | 'conduct'   // 执行培训
  | 'complete'  // 完成培训
  | 'evaluate'  // 培训评估
  | 'certify'   // 培训认证
  
  // 人员管理
  | 'attendees' // 获取参训人员
  | 'attendance' // 培训考勤
  | 'register'  // 培训报名
  | 'withdraw'  // 培训退课
  
  // 内容管理
  | 'materials' // 培训资料
  | 'curriculum' // 培训课程
  | 'assessment' // 培训考核
  
  // 统计分析
  | 'statistics' // 培训统计分析
  | 'effectiveness' // 培训效果分析
  
  // 数据管理
  | 'export'     // 培训数据导出;
```

#### 不同action的请求示例
```json
// 创建安全培训
{
  "action": "create",
  "data": {
    "training_topic": "危险品安全操作",
    "training_date": "2024-03-30",
    "trainer": 101,
    "training_content": "危险品识别、安全操作、应急处理",
    "target_audience": "仓库操作员"
  }
}

// 安排培训
{
  "action": "schedule",
  "data": {
    "training_id": 123,
    "venue": "培训室A",
    "duration": "4小时",
    "max_attendees": 20
  }
}

// 培训考勤
{
  "action": "attendance",
  "data": {
    "training_id": 123,
    "attendees": [
      {
        "employee_id": 201,
        "status": "present",
        "arrival_time": "09:00"
      }
    ]
  }
}

// 培训效果分析
{
  "action": "effectiveness",
  "params": {
    "training_id": 123,
    "evaluation_period": "3months"
  }
}
```

### 安全资质接口
**统一接口**：`POST /api/safety/certificates`

**参数说明**：`action` - 操作类型，详见 SafetyCertificateAction 类型定义

#### Action字典说明
```typescript
export type SafetyCertificateAction = 
  // 基础CRUD操作
  | 'create'    // 创建安全资质
  | 'list'      // 查询资质列表
  | 'detail'    // 获取资质详情
  | 'update'    // 更新资质信息
  | 'delete'    // 删除资质记录
  
  // 资质管理
  | 'expiring'  // 即将过期资质
  | 'renewal'   // 资质续期
  | 'revoke'    // 资质撤销
  | 'suspend'   // 资质暂停
  
  // 提醒管理
  | 'reminder'  // 续证提醒
  | 'notification' // 通知管理
  | 'escalation' // 升级提醒
  
  // 文档管理
  | 'upload'    // 上传文档
  | 'download'  // 下载文档
  | 'verify'    // 文档验证
  
  // 统计分析
  | 'statistics' // 资质统计分析
  | 'compliance' // 合规性分析
  
  // 数据管理
  | 'export'     // 资质数据导出;
```

#### 不同action的请求示例
```json
// 创建安全资质
{
  "action": "create",
  "data": {
    "certificate_type": "hazardous_materials_license",
    "certificate_number": "HML2024001",
    "issuing_authority": "深圳市应急管理局",
    "issue_date": "2024-01-01",
    "expiry_date": "2027-01-01",
    "scope": "危险化学品经营",
    "responsible_person": 101
  }
}

// 即将过期资质查询
{
  "action": "expiring",
  "params": {
    "days_ahead": 30
  }
}

// 资质续期
{
  "action": "renewal",
  "data": {
    "certificate_id": 123,
    "renewal_date": "2025-08-24",
    "new_expiry_date": "2027-12-01",
    "renewal_fee": 5000
  }
}

// 续证提醒
{
  "action": "reminder",
  "data": {
    "certificate_id": 123,
    "reminder_type": "email",
    "recipients": ["safety_manager", "responsible_person"]
  }
}
```

## 业务规则

### 仓储安全规则
1. 仓库温度必须控制在规定范围内
2. 湿度超标时必须启动除湿设备
3. 发现烟雾立即启动应急预案
4. 定期检查消防设备完好性

### 运输安全规则
1. 必须使用有资质的危险品运输公司
2. 运输包装必须符合UN标准
3. 运输过程必须全程跟踪
4. 夜间和恶劣天气禁止运输

### 合规管理规则
1. 证照到期前30天开始续证程序
2. 新员工必须完成安全培训才能上岗
3. 安全事故必须24小时内上报
4. 定期进行安全风险评估

### 应急处理规则
1. 发生事故立即启动应急预案
2. 事故现场禁止无关人员进入
3. 应急物资必须定期检查更新
4. 事故处理完毕后进行事故调查

## 关键业务流程

### 安全检查流程
```
检查计划 → 现场检查 → 问题记录 → 风险评估 → 整改要求 → 整改验证 → 记录归档
```

### 危险品运输流程
```
运输申请 → 资质审核 → 包装检查 → 路线审批 → 运输跟踪 → 到货确认 → 记录归档
```

### 应急响应流程
```
事故发生 → 立即报告 → 现场处置 → 人员救援 → 事故调查 → 整改措施 → 效果验证
```

### 安全培训流程
```
培训计划 → 培训实施 → 效果评估 → 考核测试 → 记录建档 → 跟踪改进
```

## 权限控制

### 安全检查权限
- **查看权限**：所有员工
- **检查权限**：安全员、部门主管
- **整改权限**：责任部门、安全部门
- **审核权限**：安全主管、安全经理

### 环境监控权限
- **查看权限**：仓库、安全、管理层
- **报警处理**：值班人员、安全员
- **参数设置**：安全主管、系统管理员
- **系统维护**：技术人员、系统管理员

### 运输管理权限
- **查看权限**：物流、销售、安全部门
- **运输申请**：销售员、物流专员
- **审批权限**：安全主管、物流主管
- **跟踪权限**：物流专员、客户服务

### 应急管理权限
- **事故报告**：所有员工
- **应急指挥**：应急指挥小组
- **现场处置**：应急处置小组
- **事故调查**：安全部门、管理层
