# @bolink-inventory-system/sales - 销售管理模块

## 模块概述
销售管理模块负责从客户询价到订单交付的全过程管理，确保销售活动的高效进行，提升客户满意度，优化销售业绩。

## 核心功能

### 1. 销售订单管理

#### 1.1 订单创建与录入
- **客户询价管理**：记录客户询价信息和回复
- **订单录入**：根据客户需求创建销售订单
- **产品选型**：根据客户应用场景推荐合适产品
- **价格管理**：基于客户等级和采购量确定价格
- **交期承诺**：根据库存和生产能力承诺交期

#### 1.2 订单审核与确认
- **订单审核**：检查价格、库存、信用额度
- **信用控制**：检查客户信用状况和授信余额
- **库存预留**：确认有库存后预留相应数量
- **订单确认**：向客户确认订单详情
- **合同签署**：重要订单签署正式合同

#### 1.3 订单跟踪与管理
- **订单状态跟踪**：实时跟踪订单执行状态
- **生产进度跟踪**：定制产品的生产进度跟踪
- **交期管理**：监控交期执行情况
- **订单变更**：处理客户的订单变更需求
- **订单取消**：处理订单取消申请

#### 1.4 订单分析与统计
- **订单统计**：按时间、客户、产品等维度统计
- **交期分析**：分析订单交期执行情况
- **客户分析**：分析客户订单规模和频次
- **产品分析**：分析产品销售情况和趋势

### 2. 客户关系管理

#### 2.1 客户档案管理
- **基本信息维护**：客户基本信息的维护更新
- **联系人管理**：客户主要联系人信息管理
- **分类管理**：按行业、规模、重要性分类
- **信用管理**：客户信用等级和授信额度管理

#### 2.2 客户需求管理
- **需求收集**：收集客户的产品和服务需求
- **需求分析**：分析客户需求的合理性和可行性
- **解决方案**：为客户提供定制化解决方案
- **技术支持**：提供产品技术咨询和应用指导

#### 2.3 客户关系维护
- **定期回访**：定期回访重要客户
- **客户满意度调查**：定期进行客户满意度调查
- **客户投诉处理**：及时处理客户投诉和建议
- **客户活动**：组织客户技术交流和培训活动

#### 2.4 客户价值分析
- **销售贡献分析**：分析客户的销售贡献度
- **利润贡献分析**：分析客户的利润贡献
- **成长潜力分析**：评估客户的成长潜力
- **客户生命周期管理**：管理客户的整个生命周期

### 3. 出库管理

#### 3.1 出库计划与安排
- **出库计划制定**：根据订单制定出库计划
- **库存分配**：为订单分配具体的库存批次
- **拣货策略**：制定高效的拣货路径和策略
- **人员安排**：安排拣货人员和设备

#### 3.2 拣货作业管理
- **拣货单生成**：根据订单生成拣货作业单
- **分批拣货**：按客户、区域等维度分批拣货
- **拣货确认**：拣货人员确认拣货数量和质量
- **复核检查**：拣货完成后的复核检查

#### 3.3 包装与发货管理
- **包装标准**：制定不同产品的包装标准
- **包装作业**：按标准进行产品包装
- **标签打印**：打印产品标签和运单
- **发货安排**：安排发货时间和运输方式

#### 3.4 物流跟踪管理
- **承运商管理**：管理合作的物流承运商
- **运单管理**：管理发货运单和跟踪信息
- **在途跟踪**：跟踪货物运输状态
- **签收确认**：确认客户签收情况

### 4. 退换货处理

#### 4.1 退换货申请处理
- **退货申请**：客户退货申请的接收和记录
- **退货原因分析**：分析退货原因和责任归属
- **退货审批**：退货申请的审批流程
- **换货处理**：客户换货需求的处理

#### 4.2 退货检验与处理
- **退货检验**：对退回产品进行质量检验
- **质量判定**：判定退货产品的质量状况
- **处理决定**：决定退货产品的处理方式
- **库存处理**：合格品重新入库，不合格品处理

#### 4.3 退换货成本管理
- **运费承担**：确定退换货运费的承担方
- **损失评估**：评估退换货造成的损失
- **责任认定**：认定退换货的责任方
- **成本核算**：核算退换货的全部成本

#### 4.4 退换货预防措施
- **原因统计分析**：统计分析退换货原因
- **改进措施**：针对问题制定改进措施
- **流程优化**：优化销售和物流流程
- **质量提升**：提升产品和服务质量

## 数据模型设计

### 销售订单表 (sales_orders)
```sql
- id: 主键
- order_code: 订单编号
- customer_id: 客户ID
- order_date: 订单日期
- delivery_date: 交货日期
- total_amount: 订单总金额
- discount_rate: 折扣率
- payment_terms: 付款条件
- delivery_terms: 交货条件
- status: 订单状态
- sales_person: 销售员
- created_by: 创建人
- approved_by: 审批人
- created_at: 创建时间
```

### 销售订单明细表 (sales_order_items)
```sql
- id: 主键
- order_id: 订单ID
- product_id: 产品ID
- quantity: 数量
- unit_price: 单价
- total_price: 总价
- delivery_date: 交货日期
- remarks: 备注
```

### 客户管理表 (customers)
```sql
- id: 主键
- customer_code: 客户编码
- customer_name: 客户名称
- customer_type: 客户类型
- industry: 所属行业
- contact_person: 联系人
- contact_phone: 联系电话
- contact_email: 联系邮箱
- address: 地址
- credit_level: 信用等级
- credit_limit: 授信额度
- payment_terms: 付款条件
- sales_person: 负责销售员
- status: 状态
- created_at: 创建时间
```

### 出库单表 (delivery_orders)
```sql
- id: 主键
- delivery_code: 出库单号
- order_id: 销售订单ID
- customer_id: 客户ID
- delivery_date: 出库日期
- warehouse_id: 出库仓库
- total_quantity: 总数量
- carrier: 承运商
- tracking_number: 运单号
- status: 状态
- delivered_by: 出库人
- created_at: 创建时间
```

### 出库明细表 (delivery_order_items)
```sql
- id: 主键
- delivery_id: 出库单ID
- product_id: 产品ID
- batch_number: 批次号
- quantity: 数量
- location_code: 库位编码
- remarks: 备注
```

### 退换货记录表 (return_orders)
```sql
- id: 主键
- return_code: 退货单号
- order_id: 原销售订单ID
- customer_id: 客户ID
- return_type: 退换货类型
- return_reason: 退货原因
- return_date: 退货日期
- total_quantity: 退货数量
- total_amount: 退货金额
- status: 状态
- handled_by: 处理人
- created_at: 创建时间
```

### 客户回访记录表 (customer_visits)
```sql
- id: 主键
- customer_id: 客户ID
- visit_date: 回访日期
- visit_type: 回访类型
- visit_purpose: 回访目的
- visit_content: 回访内容
- customer_feedback: 客户反馈
- next_action: 后续行动
- sales_person: 销售员
- created_at: 创建时间
```

## 接口设计

### 销售订单接口
**统一接口**：`POST /api/sales/orders`

**参数说明**：`action` - 操作类型，详见 SalesOrderAction 类型定义

#### Action字典说明
```typescript
export type SalesOrderAction = 
  // 基础CRUD操作
  | 'create'    // 创建销售订单
  | 'list'      // 查询订单列表
  | 'detail'    // 获取订单详情
  | 'update'    // 更新订单信息
  | 'delete'    // 删除订单
  
  // 订单流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交审批
  | 'approve'   // 审批通过
  | 'reject'    // 审批拒绝
  | 'confirm'   // 订单确认
  | 'cancel'    // 取消订单
  
  // 订单跟踪
  | 'tracking'  // 订单跟踪查询
  | 'status'    // 订单状态变更
  | 'items'     // 订单明细查询
  | 'update-item' // 订单明细更新
  
  // 库存管理
  | 'reserve'   // 库存预留
  | 'release'   // 释放预留
  | 'allocate'  // 库存分配
  
  // 批量操作
  | 'batch-approve' // 批量审批
  | 'batch-cancel'  // 批量取消
  | 'batch-export'  // 批量导出
  
  // 统计分析
  | 'statistics' // 订单统计分析
  | 'trends'     // 订单趋势分析
  
  // 数据管理
  | 'export'     // 订单数据导出
  | 'import'     // 订单数据导入;
```

#### 不同action的请求示例
```json
// 创建销售订单
{
  "action": "create",
  "data": {
    "customer_id": 123,
    "order_date": "2024-03-20",
    "delivery_date": "2024-04-20",
    "payment_terms": "月结30天",
    "items": [
      {
        "product_id": 456,
        "quantity": 100,
        "unit_price": 200
      }
    ]
  }
}

// 订单审批
{
  "action": "approve",
  "data": {
    "order_id": 789,
    "approved_by": 101,
    "comments": "审批通过"
  }
}

// 库存预留
{
  "action": "reserve",
  "data": {
    "order_id": 789,
    "reserved_by": 102
  }
}

// 查询订单列表
{
  "action": "list",
  "params": {
    "page": 1,
    "size": 20,
    "status": "confirmed",
    "customer_id": 123
  }
}
```

### 出库管理接口
**统一接口**：`POST /api/sales/deliveries`

**参数说明**：`action` - 操作类型，详见 DeliveryManagementAction 类型定义

#### Action字典说明
```typescript
export type DeliveryManagementAction = 
  // 基础CRUD操作
  | 'create'    // 创建出库单
  | 'list'      // 查询出库单列表
  | 'detail'    // 获取出库单详情
  | 'update'    // 更新出库单
  | 'delete'    // 删除出库单
  
  // 出库流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交审批
  | 'approve'   // 审批通过
  | 'reject'    // 审批拒绝
  | 'execute'   // 执行出库
  | 'cancel'    // 取消出库
  
  // 出库作业
  | 'pick'      // 拣货计划
  | 'pack'      // 包装管理
  | 'ship'      // 发货管理
  | 'confirm'   // 发货确认
  
  // 明细管理
  | 'items'     // 出库明细查询
  | 'update-item' // 出库明细更新
  
  // 物流跟踪
  | 'logistics-tracking' // 物流跟踪
  | 'tracking'  // 运输跟踪
  | 'delivery-confirm' // 签收确认
  
  // 异常处理
  | 'exceptions' // 异常处理
  | 'delay'     // 延期处理
  
  // 统计分析
  | 'statistics' // 出库统计分析
  | 'efficiency' // 出库效率分析
  
  // 数据管理
  | 'export'     // 出库数据导出;
```

#### 不同action的请求示例
```json
// 创建出库单
{
  "action": "create",
  "data": {
    "order_id": 123,
    "delivery_date": "2024-03-25",
    "warehouse_id": 456,
    "carrier": "顺丰速运",
    "items": [
      {
        "product_id": 789,
        "quantity": 50,
        "batch_number": "BT20240320001"
      }
    ]
  }
}

// 拣货计划
{
  "action": "pick",
  "data": {
    "delivery_id": 123,
    "pick_strategy": "batch_pick",
    "assigned_to": 456
  }
}

// 物流跟踪
{
  "action": "logistics-tracking",
  "params": {
    "delivery_id": 123
  }
}

// 发货确认
{
  "action": "confirm",
  "data": {
    "delivery_id": 123,
    "tracking_number": "SF1234567890",
    "shipped_by": 456
  }
}
```

### 退换货管理接口
**统一接口**：`POST /api/sales/returns`

**参数说明**：`action` - 操作类型，详见 ReturnManagementAction 类型定义

#### Action字典说明
```typescript
export type ReturnManagementAction = 
  // 基础CRUD操作
  | 'create'    // 创建退换货单
  | 'list'      // 查询退换货单列表
  | 'detail'    // 获取退换货单详情
  | 'update'    // 更新退换货单
  | 'delete'    // 删除退换货单
  
  // 退换货流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交申请
  | 'approve'   // 审批通过
  | 'reject'    // 审批拒绝
  | 'process'   // 处理退换货
  | 'cancel'    // 取消退换货
  
  // 质量检验
  | 'quality-inspection' // 退货质量检验
  | 'inspect'   // 检验操作
  | 'quality-report' // 质量报告
  
  // 处理决定
  | 'refund'    // 退款处理
  | 'exchange'  // 换货处理
  | 'repair'    // 维修处理
  | 'scrap'     // 报废处理
  
  // 详情管理
  | 'details'   // 退换货详情
  | 'update-detail' // 更新详情
  
  // 原因分析
  | 'reason-analysis' // 退货原因分析
  | 'prevention-measures' // 预防措施
  
  // 统计分析
  | 'statistics' // 退换货统计分析
  | 'trends'     // 退换货趋势分析
  
  // 数据管理
  | 'export'     // 退换货数据导出;
```

#### 不同action的请求示例
```json
// 创建退换货单
{
  "action": "create",
  "data": {
    "order_id": 123,
    "return_type": "return",
    "return_reason": "质量问题",
    "items": [
      {
        "product_id": 456,
        "quantity": 10,
        "return_reason": "外观缺陷"
      }
    ]
  }
}

// 质量检验
{
  "action": "quality-inspection",
  "data": {
    "return_id": 789,
    "inspection_result": "defective",
    "defect_type": "appearance",
    "inspector": 101
  }
}

// 退款处理
{
  "action": "refund",
  "data": {
    "return_id": 789,
    "refund_amount": 2000,
    "refund_method": "bank_transfer",
    "processed_by": 102
  }
}

// 退货原因分析
{
  "action": "reason-analysis",
  "params": {
    "period": "2024-Q1",
    "product_id": 456
  }
}
```

### 客户管理接口
**统一接口**：`POST /api/sales/customers`

**参数说明**：`action` - 操作类型，详见 CustomerManagementAction 类型定义

#### Action字典说明
```typescript
export type CustomerManagementAction = 
  // 基础CRUD操作
  | 'create'    // 创建客户
  | 'list'      // 查询客户列表
  | 'detail'    // 获取客户详情
  | 'update'    // 更新客户信息
  | 'delete'    // 删除客户
  
  // 客户查询
  | 'by-salesperson' // 按销售员查询客户
  | 'by-industry'    // 按行业查询客户
  | 'by-region'      // 按地区查询客户
  
  // 订单历史
  | 'orders'    // 获取客户订单历史
  | 'returns'   // 获取客户退换货历史
  | 'activities' // 获取客户活动历史
  
  // 信用管理
  | 'credit-check' // 客户信用检查
  | 'credit-limit' // 设置信用额度
  | 'credit-analysis' // 客户信用分析
  | 'risk-assessment' // 客户风险评估
  
  // 客户分类
  | 'classify'  // 客户分类管理
  | 'upgrade'   // 客户升级
  | 'downgrade' // 客户降级
  
  // 统计分析
  | 'statistics' // 客户统计分析
  | 'value-analysis' // 客户价值分析
  
  // 数据管理
  | 'export'     // 客户数据导出
  | 'import'     // 客户数据导入;
```

#### 不同action的请求示例
```json
// 创建客户
{
  "action": "create",
  "data": {
    "customer_name": "比亚迪股份有限公司",
    "customer_type": "manufacturer",
    "industry": "新能源汽车",
    "contact_person": "张三",
    "contact_phone": "0755-12345678",
    "credit_level": "AAA"
  }
}

// 客户信用检查
{
  "action": "credit-check",
  "params": {
    "customer_id": 123,
    "order_amount": 50000
  }
}

// 设置信用额度
{
  "action": "credit-limit",
  "data": {
    "customer_id": 123,
    "credit_limit": 1000000,
    "payment_terms": "月结30天"
  }
}

// 客户价值分析
{
  "action": "value-analysis",
  "params": {
    "customer_id": 123,
    "period": "2024-Q1"
  }
}
```

### 客户回访接口
**统一接口**：`POST /api/sales/visits`

**参数说明**：`action` - 操作类型，详见 CustomerVisitAction 类型定义

#### Action字典说明
```typescript
export type CustomerVisitAction = 
  // 基础CRUD操作
  | 'create'    // 创建客户回访
  | 'list'      // 查询回访列表
  | 'detail'    // 获取回访详情
  | 'update'    // 更新回访信息
  | 'delete'    // 删除回访记录
  
  // 回访查询
  | 'by-customer' // 按客户查询回访
  | 'by-salesperson' // 按销售员查询回访
  | 'by-date'    // 按日期查询回访
  
  // 回访计划
  | 'schedule'  // 安排回访计划
  | 'reminder'  // 发送回访提醒
  | 'reschedule' // 重新安排回访
  
  // 回访执行
  | 'start'     // 开始回访
  | 'complete'  // 完成回访
  | 'follow-up' // 后续跟进
  
  // 反馈分析
  | 'feedback-analysis' // 回访反馈分析
  | 'satisfaction' // 满意度分析
  
  // 统计分析
  | 'statistics' // 回访统计分析
  | 'effectiveness' // 回访效果分析
  
  // 数据管理
  | 'export'     // 回访数据导出;
```

#### 不同action的请求示例
```json
// 创建客户回访
{
  "action": "create",
  "data": {
    "customer_id": 123,
    "visit_date": "2024-03-25",
    "visit_type": "regular",
    "visit_purpose": "客户维护",
    "sales_person": 456
  }
}

// 安排回访计划
{
  "action": "schedule",
  "data": {
    "customer_id": 123,
    "planned_date": "2024-03-30",
    "visit_type": "technical_support",
    "assigned_to": 456
  }
}

// 完成回访
{
  "action": "complete",
  "data": {
    "visit_id": 789,
    "visit_content": "技术交流",
    "customer_feedback": "满意",
    "next_action": "继续跟进"
  }
}

// 回访反馈分析
{
  "action": "feedback-analysis",
  "params": {
    "period": "2024-Q1",
    "customer_id": 123
  }
}
```

## 业务规则

### 订单管理规则
1. 订单编号自动生成：SO-YYYYMMDD-XXX
2. 订单金额超过客户授信需要特别审批
3. 库存不足时不能确认订单
4. 订单确认后不允许随意修改

### 客户管理规则
1. 客户编码自动生成：CUS-YYYYMMDD-XXX
2. 新客户必须进行信用评估
3. 重要客户必须指定专人负责
4. 客户信息变更需要销售经理确认

### 出库管理规则
1. 出库必须有对应的销售订单
2. 出库数量不能超过订单数量
3. 必须遵循先进先出原则
4. 出库后24小时内必须发货

### 退换货规则
1. 退货必须在交货后30天内申请
2. 非质量问题退货客户承担运费
3. 退货产品必须包装完好
4. 退货金额超过1万需要经理审批

## 关键业务流程

### 销售订单流程
```
客户询价 → 报价回复 → 订单创建 → 信用审核 → 库存确认 → 订单确认 → 生产安排
```

### 出库发货流程
```
出库计划 → 库存分配 → 拣货作业 → 质量检查 → 包装发货 → 物流跟踪 → 签收确认
```

### 客户服务流程
```
需求收集 → 需求分析 → 方案设计 → 方案确认 → 服务提供 → 效果评估 → 持续优化
```

### 退换货流程
```
退货申请 → 原因分析 → 退货审批 → 退货检验 → 处理决定 → 库存处理 → 财务处理
```

## 权限控制

### 订单管理权限
- **查看权限**：销售部门、管理层
- **创建权限**：销售员、销售主管
- **审批权限**：销售主管、销售经理
- **修改权限**：订单创建人（确认前）

### 客户管理权限
- **查看权限**：销售部门
- **创建权限**：销售员、销售主管
- **修改权限**：客户负责人、销售主管
- **删除权限**：销售经理、系统管理员

### 出库管理权限
- **查看权限**：销售、仓库、管理层
- **创建权限**：销售员、仓库管理员
- **出库权限**：仓库管理员
- **发货权限**：仓库管理员、物流专员

### 退换货权限
- **查看权限**：销售、客服、管理层
- **申请权限**：销售员、客服专员
- **审批权限**：销售主管、客服主管
- **处理权限**：仓库管理员、质量检验员
