# 新能源电池进销存信息管理系统模块设计

## 项目概述
- **项目名称**：新能源电池进销存信息管理系统
- **目标用户**：产业链中间环节（批发/贸易/分销商）
- **系统特点**：专注进销存流转，不涉及财务和复杂售后服务

## 系统架构 - @bolink-inventory-system/

### API设计模式
- **统一接口设计**: 每个业务子模块使用单一POST端点，通过action参数区分操作
- **模块专属Action字典**: 每个模块拥有独立的业务操作类型定义
- **类型安全**: 使用TypeScript定义Action字典，确保前后端类型一致
- **接口简化**: 从503个传统REST接口优化为42个统一接口
- **业务导向**: Action设计基于具体业务场景，提高语义化程度

### 1. @bolink-inventory-system/basic-data
**基础数据管理模块**
```
功能范围：
├── 电池产品信息管理
│   ├── 产品型号、规格、容量、电压
│   ├── 品牌信息、技术参数
│   └── 产品分类、编码管理
├── 供应商管理
│   ├── 供应商资质、联系方式
│   ├── 合作协议、评价等级
│   └── 供应商分类、黑白名单
├── 客户管理
│   ├── 客户档案、联系信息
│   ├── 客户分类、信用等级
│   └── 合同信息、价格管理
└── 仓库管理
    ├── 仓库位置、容量规划
    ├── 环境要求、安全等级
    └── 库区划分、货位管理

统一API接口：
├── POST /api/basic-data/products - 产品管理统一接口
├── POST /api/basic-data/suppliers - 供应商管理统一接口
├── POST /api/basic-data/customers - 客户管理统一接口
└── POST /api/basic-data/warehouses - 仓库管理统一接口
```

### 2. @bolink-inventory-system/procurement
**采购管理模块**
```
功能范围：
├── 采购计划
│   ├── 基于库存预警制定计划
│   ├── 销售预测驱动采购
│   └── 季节性采购计划
├── 供应商评估
│   ├── 多供应商比价
│   ├── 质量评价、交期评价
│   └── 服务评价、长期合作评估
├── 采购订单
│   ├── 订单创建、审批流程
│   ├── 订单跟踪、变更管理
│   └── 到货提醒、催货管理
└── 入库验收
    ├── 质量检验、数量核对
    ├── 批次管理、入库登记
    └── 验收单据、异常处理
```

### 3. @bolink-inventory-system/inventory
**库存管理模块**
```
功能范围：
├── 库存监控
│   ├── 实时库存查询
│   ├── 库存预警、安全库存设置
│   └── 多仓库库存统一管理
├── 批次管理
│   ├── 生产批次、有效期管理
│   ├── 先进先出(FIFO)策略
│   └── 批次追溯、质量关联
├── 库位管理
│   ├── 货位分配、智能推荐
│   ├── 盘点管理、差异处理
│   └── 移库操作、库存调拨
├── 库存调拨
│   ├── 多仓库间调拨
│   ├── 调拨单据、审批流程
│   └── 在途库存管理
└── 库存预留管理
    ├── 销售订单预留
    ├── 预留优先级管理
    ├── 自动过期释放
    └── 预留分析报表
```

### 4. @bolink-inventory-system/sales
**销售管理模块**
```
功能范围：
├── 销售订单
│   ├── 订单录入、产品推荐
│   ├── 价格管理、交期承诺
│   └── 订单跟踪、状态管理
├── 客户管理
│   ├── 客户档案维护
│   ├── 信用等级、授信管理
│   └── 客户需求分析、关系维护
├── 出库管理
│   ├── 拣货管理、拣货策略
│   ├── 包装标准、包装要求
│   └── 发货安排、物流跟踪
└── 退换货处理
    ├── 退货申请、审批流程
    ├── 质量问题处理
    └── 退货入库、库存更新
```

### 5. @bolink-inventory-system/quality
**质量控制模块**
```
功能范围：
├── 质量检验管理
│   ├── 入库质量检验
│   ├── 检验标准管理
│   ├── 检验设备管理
│   └── 检验结果管理
├── 批次追溯管理
│   ├── 批次信息建档
│   ├── 上游追溯、下游追溯
│   ├── 问题批次快速定位
│   └── 追溯查询功能
├── 不合格品处理
│   ├── 不合格品识别
│   ├── 不合格品隔离
│   ├── 不合格品处置
│   └── 原因分析与改进
└── 供应商质量评价
    ├── 质量绩效统计
    ├── 质量评价体系
    └── 供应商分级管理
```

### 6. @bolink-inventory-system/safety
**安全管理模块**
```
功能范围：
├── 仓储安全
│   ├── 温度监控、湿度控制
│   ├── 防火防爆、通风管理
│   └── 安全设备、监控系统
├── 运输安全
│   ├── 危险品运输规范
│   ├── 包装安全要求
│   └── 运输路线安全评估
├── 合规管理
│   ├── 行业法规遵循
│   ├── 环保要求、资质管理
│   └── 安全认证、定期检查
└── 应急处理
    ├── 事故应急预案
    ├── 应急联系人、救援设备
    └── 安全培训、演练记录
```

### 7. @bolink-inventory-system/reports
**报表统计模块**
```
功能范围：
├── 进销存报表
│   ├── 库存明细报表
│   ├── 进销存汇总报表
│   └── 库存变动分析
├── 库存分析
│   ├── ABC分析、库存结构分析
│   ├── 呆滞库存分析
│   └── 库存周转率分析
├── 供应商绩效
│   ├── 供应商交期分析
│   ├── 质量绩效统计
│   └── 采购成本分析
└── 客户分析
    ├── 客户销售排行
    ├── 客户贡献度分析
    └── 客户需求趋势分析
```

### 8. @bolink-inventory-system/system
**系统管理模块**
```
功能范围：
├── 用户权限
│   ├── 用户管理、角色管理
│   ├── 权限分配、功能授权
│   └── 操作日志、审计跟踪
├── 基础配置
│   ├── 系统参数配置
│   ├── 业务流程配置
│   └── 提醒设置、打印模板
├── 数据备份
│   ├── 定期数据备份
│   ├── 数据恢复、版本控制
│   └── 数据安全、加密管理
└── 接口管理
    ├── 与ERP系统集成
    ├── 与物流系统对接
    └── 第三方系统数据同步
```

## 模块间关系

### 核心数据流
```
采购流程：@bolink-inventory-system/procurement → @bolink-inventory-system/inventory
销售流程：@bolink-inventory-system/sales → @bolink-inventory-system/inventory
质量管控：@bolink-inventory-system/quality ↔ @bolink-inventory-system/inventory
安全监管：@bolink-inventory-system/safety → 所有操作模块
数据支撑：@bolink-inventory-system/basic-data → 所有业务模块
统计分析：@bolink-inventory-system/reports ← 所有业务模块
系统支撑：@bolink-inventory-system/system → 所有模块
```

### 关键集成点
1. **库存中心化**：所有业务操作都影响库存状态
2. **质量贯穿**：从采购入库到销售出库的全程质量管控
3. **安全优先**：所有操作都需要考虑安全规范
4. **数据驱动**：基于准确的基础数据进行业务决策

## 技术架构建议

### 前端架构
- **技术栈**：React 18 + TypeScript + Vite + Material-UI (MUI)
- **架构模式**：微前端架构，每个模块独立开发部署
- **状态管理**：Redux Toolkit + RTK Query，模块间状态隔离
- **构建工具**：Vite，快速开发和热更新
- **UI组件库**：Material-UI，提供一致的设计语言
- **API调用**：统一API设计模式，使用action参数区分操作

### 后端架构
- **技术栈**：NestJS + TypeScript + PostgreSQL + TypeORM
- **架构模式**：微服务架构，按模块拆分服务
- **API设计**：统一API设计模式，Action驱动的接口设计
- **API文档**：Swagger/OpenAPI，自动生成接口文档
- **数据库ORM**：TypeORM，类型安全的数据库操作
- **服务治理**：NestJS内置的模块系统 + Docker Compose

### 数据架构
- **主数据库**：PostgreSQL 14+，支持JSON字段和复杂查询
- **缓存层**：Redis，提升查询性能和会话管理
- **消息队列**：Bull Queue (基于Redis)，处理异步任务
- **数据迁移**：TypeORM Migrations，版本化数据库变更

### API架构
- **统一接口**: 每个业务子模块一个POST端点
- **Action字典**: 模块专属的操作类型定义
- **类型安全**: TypeScript类型定义确保前后端一致性
- **错误处理**: 统一的错误响应格式和状态码
- **权限控制**: 基于角色的接口访问控制
- **日志记录**: 完整的操作日志和审计追踪

## 数据库设计概览

### 表结构统计
- **总表数**：50个表（包括4个分区表）
- **索引数量**：185个索引
- **触发器数量**：32个触发器
- **视图数量**：7个视图 + 1个物化视图
- **函数数量**：12个PL/pgSQL函数

### 核心业务表
- **基础数据**：4个表（产品、供应商、客户、仓库）
- **库存管理**：8个表（库存、流水、预警、盘点、调拨、预留等）
- **采购管理**：4个表（采购订单、收货、供应商评估等）
- **销售管理**：4个表（销售订单、出库、客户关系等）
- **质量管理**：2个表（质量检验、批次追溯）
- **安全管理**：6个表（安全检查、环境监控、危险品运输等）
- **报表统计**：6个表（报表模板、生成记录、定时任务等）
- **系统管理**：7个表（用户、角色、权限、日志等）
- **补充业务**：2个表（退换货、客户回访）

## 部署建议

### 开发环境
- 每个模块独立仓库
- 统一的CI/CD流水线
- 容器化部署(Docker)

### 生产环境
- Kubernetes集群部署
- 服务网格(Istio)管理
- 监控告警(Prometheus + Grafana)
