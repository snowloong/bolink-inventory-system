# @bolink-inventory-system/procurement - 采购管理模块

## 模块概述
采购管理模块负责整个采购流程的管理，从采购计划制定到货物入库验收的全过程控制，确保采购活动的高效、合规和成本优化。

## 核心功能

### 1. 采购计划管理

#### 1.1 库存驱动采购计划
- **安全库存监控**：基于安全库存设置自动生成采购需求
- **补货点计算**：根据历史消耗和交期计算最优补货点
- **ABC分析**：重点管控A类产品的采购计划
- **季节性调整**：考虑季节性需求波动调整采购计划

#### 1.2 销售预测驱动采购
- **销售预测分析**：基于历史销售数据预测未来需求
- **客户订单分析**：分析客户长期合同和框架协议
- **市场趋势分析**：结合行业趋势调整采购策略
- **新产品导入**：新产品上市的采购准备计划

#### 1.3 采购计划制定
- **月度采购计划**：每月滚动更新的采购计划
- **季度采购计划**：季度性大宗采购计划
- **年度框架协议**：与主要供应商的年度合作计划
- **紧急采购计划**：应急情况下的快速采购方案

#### 1.4 计划审批流程
- **计划提交**：采购员提交月度采购计划
- **部门审核**：采购主管审核计划合理性
- **管理层批准**：超过预算的计划需要管理层批准
- **计划发布**：审批通过后正式发布执行

### 2. 供应商评估与选择

#### 2.1 供应商资质评估
- **基础资质审查**：营业执照、危险品经营许可等
- **质量体系认证**：ISO9001、TS16949等质量认证
- **财务状况评估**：财务报表分析、信用状况调查
- **生产能力评估**：产能、设备、技术水平评估

#### 2.2 多供应商比价
- **询价管理**：向多家供应商发起询价
- **价格比较分析**：价格、交期、付款条件综合比较
- **总成本分析**：采购价格+运输+税费+风险成本
- **性价比评估**：质量、服务、价格的综合评分

#### 2.3 供应商绩效评价
- **交期绩效**：按时交货率、提前/延迟交货分析
- **质量绩效**：入库合格率、质量问题统计
- **服务绩效**：响应速度、问题解决能力
- **成本绩效**：价格竞争力、成本优化建议
- **合规绩效**：法规遵循、资质维护情况

#### 2.4 供应商关系管理
- **分级管理**：战略、重要、一般、淘汰四级管理
- **定期评审**：季度/年度供应商绩效评审
- **改进计划**：针对问题供应商的改进措施
- **长期合作**：与优秀供应商建立战略伙伴关系

### 3. 采购订单管理

#### 3.1 采购订单创建
- **需求汇总**：根据采购计划汇总采购需求
- **供应商选择**：基于评估结果选择最优供应商
- **合同条款**：价格、交期、质量标准、付款条件
- **订单确认**：与供应商确认订单详情

#### 3.2 订单审批流程
- **金额分级审批**：不同金额采用不同审批级别
- **特殊采购审批**：新供应商、新产品的特殊审批
- **紧急采购审批**：紧急情况下的快速审批通道
- **变更审批**：订单变更的审批流程

#### 3.3 订单跟踪管理
- **订单状态跟踪**：已下单、已确认、生产中、已发货、已到货
- **交期跟踪**：实时跟踪订单交期状态
- **问题跟踪**：记录和跟踪订单执行中的问题
- **沟通记录**：与供应商的沟通记录管理

#### 3.4 订单变更管理
- **变更申请**：价格、数量、交期、规格变更申请
- **变更评估**：评估变更对成本、交期的影响
- **变更审批**：根据影响程度确定审批级别
- **变更执行**：与供应商确认变更并执行

### 4. 入库验收管理

#### 4.1 到货通知与安排
- **到货预告**：供应商提前通知发货信息
- **收货安排**：安排收货时间、人员、设备
- **运输跟踪**：跟踪货物运输状态
- **到货确认**：确认货物到达并安排卸货

#### 4.2 收货验收流程
- **数量验收**：核对到货数量与订单数量
- **包装检查**：检查包装完整性、标识清晰度
- **外观检查**：检查产品外观、有无破损
- **单据核对**：核对送货单、发票等单据

#### 4.3 质量检验
- **抽样检验**：根据检验标准进行抽样
- **性能测试**：基础性能参数测试
- **安全检查**：电池安全性能检查
- **合格判定**：根据检验结果判定合格或不合格

#### 4.4 入库处理
- **合格品入库**：检验合格的产品办理入库手续
- **不合格品处理**：隔离存放，联系供应商处理
- **批次管理**：建立批次档案，记录批次信息
- **单据归档**：相关单据整理归档

## 数据模型设计

### 采购计划表 (procurement_plans)
```sql
- id: 主键
- plan_code: 计划编号
- plan_period: 计划期间
- product_id: 产品ID
- planned_quantity: 计划数量
- planned_amount: 计划金额
- reason: 采购原因
- status: 状态
- created_by: 创建人
- approved_by: 审批人
- created_at: 创建时间
- approved_at: 审批时间
```

### 供应商评估表 (supplier_evaluations)
```sql
- id: 主键
- supplier_id: 供应商ID
- evaluation_period: 评估期间
- delivery_score: 交期评分
- quality_score: 质量评分
- service_score: 服务评分
- cost_score: 成本评分
- total_score: 总评分
- level: 评估等级
- remarks: 备注
- created_at: 创建时间
```

### 采购订单表 (purchase_orders)
```sql
- id: 主键
- order_code: 订单编号
- supplier_id: 供应商ID
- order_date: 订单日期
- expected_date: 预期到货日期
- total_amount: 订单总金额
- payment_terms: 付款条件
- delivery_terms: 交货条件
- status: 订单状态
- created_by: 创建人
- approved_by: 审批人
- created_at: 创建时间
```

### 采购订单明细表 (purchase_order_items)
```sql
- id: 主键
- order_id: 订单ID
- product_id: 产品ID
- quantity: 数量
- unit_price: 单价
- total_price: 总价
- required_date: 需求日期
- remarks: 备注
```

### 收货记录表 (receiving_records)
```sql
- id: 主键
- record_code: 收货单号
- order_id: 采购订单ID
- received_date: 收货日期
- received_by: 收货人
- total_quantity: 总数量
- status: 状态
- remarks: 备注
- created_at: 创建时间
```

### 质量检验表 (quality_inspections)
```sql
- id: 主键
- inspection_code: 检验单号
- receiving_id: 收货记录ID
- product_id: 产品ID
- batch_number: 批次号
- sample_quantity: 抽样数量
- inspection_result: 检验结果
- inspector: 检验员
- inspection_date: 检验日期
- remarks: 备注
```

## 接口设计

### 采购计划接口
**统一接口**：`POST /api/procurement/plans`

**参数说明**：`action` - 操作类型，详见 ProcurementPlanAction 类型定义

#### Action字典说明
```typescript
export type ProcurementPlanAction = 
  // 基础CRUD操作
  | 'create'    // 创建采购计划
  | 'list'      // 查询采购计划列表
  | 'detail'    // 获取采购计划详情
  | 'update'    // 更新采购计划
  | 'delete'    // 删除采购计划
  
  // 业务流程操作
  | 'draft'     // 保存草稿
  | 'submit'    // 提交审批
  | 'approve'   // 审批通过
  | 'reject'    // 审批拒绝
  | 'cancel'    // 取消计划
  
  // 批量操作
  | 'batch-approve'  // 批量审批
  | 'batch-reject'   // 批量拒绝
  | 'batch-delete'   // 批量删除
  | 'batch-export'   // 批量导出
  
  // 计划分析
  | 'statistics'     // 计划统计分析
  | 'trends'         // 计划趋势分析
  | 'comparison'     // 计划对比分析
  
  // 数据管理
  | 'export'         // 计划数据导出
  | 'import'         // 计划数据导入
  | 'template'       // 计划模板管理;
```

#### 不同action的请求示例
```json
// 创建采购计划
{
  "action": "create",
  "data": {
    "plan_period": "2024-03",
    "product_id": 123,
    "planned_quantity": 1000,
    "planned_amount": 500000,
    "reason": "库存补充"
  }
}

// 提交审批
{
  "action": "submit",
  "data": {
    "plan_id": 456,
    "approver_id": 789,
    "comments": "请审批"
  }
}

// 查询计划列表
{
  "action": "list",
  "params": {
    "page": 1,
    "size": 20,
    "status": "pending",
    "plan_period": "2024-03"
  }
}
```

### 供应商评估接口
**统一接口**：`POST /api/procurement/evaluations`

**参数说明**：`action` - 操作类型，详见 SupplierEvaluationAction 类型定义

#### Action字典说明
```typescript
export type SupplierEvaluationAction = 
  // 基础CRUD操作
  | 'create'    // 创建供应商评估
  | 'list'      // 查询评估列表
  | 'detail'    // 获取评估详情
  | 'update'    // 更新评估信息
  | 'delete'    // 删除评估记录
  
  // 评估流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交评估
  | 'approve'   // 评估审批
  | 'reject'    // 评估拒绝
  
  // 绩效分析
  | 'performance' // 供应商绩效查询
  | 'history'     // 评估历史记录
  | 'trends'      // 评估趋势分析
  | 'comparison'  // 供应商对比分析
  
  // 报告管理
  | 'reports'     // 评估报告生成
  | 'export'      // 评估数据导出
  | 'import'      // 评估数据导入
  
  // 批量操作
  | 'batch-evaluate' // 批量评估
  | 'batch-export'   // 批量导出;
```

#### 不同action的请求示例
```json
// 创建供应商评估
{
  "action": "create",
  "data": {
    "supplier_id": 123,
    "evaluation_period": "2024-Q1",
    "delivery_score": 85,
    "quality_score": 90,
    "service_score": 88,
    "cost_score": 82
  }
}

// 查询供应商绩效
{
  "action": "performance",
  "params": {
    "supplier_id": 123,
    "period": "2024-Q1"
  }
}

// 生成评估报告
{
  "action": "reports",
  "data": {
    "evaluation_id": 456,
    "report_type": "detailed",
    "include_charts": true
  }
}
```

### 采购订单接口
**统一接口**：`POST /api/procurement/orders`

**参数说明**：`action` - 操作类型，详见 PurchaseOrderAction 类型定义

#### Action字典说明
```typescript
export type PurchaseOrderAction = 
  // 基础CRUD操作
  | 'create'    // 创建采购订单
  | 'list'      // 查询订单列表
  | 'detail'    // 获取订单详情
  | 'update'    // 更新订单信息
  | 'delete'    // 删除订单
  
  // 订单流程
  | 'draft'     // 保存草稿
  | 'submit'    // 提交审批
  | 'approve'   // 审批通过
  | 'reject'    // 审批拒绝
  | 'confirm'   // 供应商确认
  | 'cancel'    // 取消订单
  
  // 订单跟踪
  | 'tracking'  // 订单跟踪查询
  | 'status'    // 订单状态变更
  | 'items'     // 订单明细查询
  | 'update-item' // 订单明细更新
  
  // 批量操作
  | 'batch-approve' // 批量审批
  | 'batch-reject'  // 批量拒绝
  | 'batch-export'  // 批量导出
  
  // 统计分析
  | 'statistics' // 订单统计分析
  | 'trends'     // 订单趋势分析
  
  // 数据管理
  | 'export'     // 订单数据导出
  | 'import'     // 订单数据导入;
```

#### 不同action的请求示例
```json
// 创建采购订单
{
  "action": "create",
  "data": {
    "supplier_id": 123,
    "order_date": "2024-03-15",
    "expected_date": "2024-04-15",
    "payment_terms": "月结30天",
    "items": [
      {
        "product_id": 456,
        "quantity": 500,
        "unit_price": 100
      }
    ]
  }
}

// 订单跟踪查询
{
  "action": "tracking",
  "params": {
    "order_id": 789
  }
}

// 订单状态变更
{
  "action": "status",
  "data": {
    "order_id": 789,
    "status": "confirmed",
    "comments": "供应商已确认"
  }
}
```

### 收货验收接口
**统一接口**：`POST /api/procurement/receiving`

**参数说明**：`action` - 操作类型，详见 ReceivingAction 类型定义

#### Action字典说明
```typescript
export type ReceivingAction = 
  // 基础CRUD操作
  | 'create'    // 创建收货记录
  | 'list'      // 查询收货记录列表
  | 'detail'    // 获取收货记录详情
  | 'update'    // 更新收货记录
  | 'delete'    // 删除收货记录
  
  // 收货流程
  | 'arrival'   // 到货通知
  | 'receive'   // 收货确认
  | 'inspect'   // 质量检验
  | 'approve'   // 验收通过
  | 'reject'    // 验收拒绝
  
  // 明细管理
  | 'items'     // 收货明细查询
  | 'update-item' // 收货明细更新
  | 'exceptions' // 异常处理
  
  // 状态管理
  | 'status'    // 收货状态变更
  
  // 统计分析
  | 'statistics' // 收货统计分析
  | 'trends'     // 收货趋势分析
  
  // 数据管理
  | 'export'     // 收货数据导出;
```

#### 不同action的请求示例
```json
// 创建收货记录
{
  "action": "create",
  "data": {
    "order_id": 123,
    "received_date": "2024-03-20",
    "received_by": 456,
    "items": [
      {
        "product_id": 789,
        "received_quantity": 500,
        "batch_number": "BT20240320001"
      }
    ]
  }
}

// 质量检验
{
  "action": "inspect",
  "data": {
    "receiving_id": 123,
    "inspection_result": "qualified",
    "sample_quantity": 50,
    "inspector": 456,
    "remarks": "检验合格"
  }
}

// 收货明细查询
{
  "action": "items",
  "params": {
    "receiving_id": 123
  }
}
```

### 价格管理接口
**统一接口**：`POST /api/procurement/prices`

**参数说明**：`action` - 操作类型，详见 PriceManagementAction 类型定义

#### Action字典说明
```typescript
export type PriceManagementAction = 
  // 价格查询
  | 'history'   // 价格历史查询
  | 'current'   // 当前价格查询
  | 'trends'    // 价格趋势分析
  | 'comparison' // 价格对比分析
  
  // 价格管理
  | 'create'    // 创建价格记录
  | 'update'    // 更新价格
  | 'approve'   // 价格审批
  | 'reject'    // 价格拒绝
  
  // 统计分析
  | 'statistics' // 价格统计分析
  | 'analysis'   // 价格分析报告
  
  // 数据管理
  | 'export'     // 价格数据导出
  | 'import'     // 价格数据导入;
```

#### 不同action的请求示例
```json
// 价格历史查询
{
  "action": "history",
  "params": {
    "product_id": 123,
    "supplier_id": 456,
    "start_date": "2024-01-01",
    "end_date": "2024-03-31"
  }
}

// 价格趋势分析
{
  "action": "trends",
  "params": {
    "product_id": 123,
    "period": "6months"
  }
}

// 价格对比分析
{
  "action": "comparison",
  "data": {
    "product_id": 123,
    "supplier_ids": [456, 789, 101],
    "quantity": 1000
  }
}
```

## 业务规则

### 采购计划规则
1. 计划编号自动生成：PC-YYYYMM-XXX
2. 月度计划必须在月初提交
3. 计划金额超过预算需要特别审批
4. 紧急采购需要说明原因

### 供应商选择规则
1. 新供应商必须通过资质审核
2. A类产品必须从合格供应商清单选择
3. 单一供应商采购金额不超过总采购额的30%
4. 必须保持至少2家合格供应商

### 订单审批规则
1. 10万以下：采购主管审批
2. 10-50万：采购经理审批
3. 50万以上：总经理审批
4. 紧急订单可以先执行后补批

### 验收入库规则
1. 所有货物必须经过数量和质量检验
2. 不合格品必须隔离存放
3. 批次信息必须完整记录
4. 验收合格后24小时内入库

## 关键业务流程

### 采购计划流程
```
需求分析 → 计划制定 → 部门审核 → 管理批准 → 计划发布 → 执行跟踪
```

### 供应商选择流程
```
需求确定 → 供应商筛选 → 询价比价 → 综合评估 → 供应商确定 → 合同谈判
```

### 采购订单流程
```
订单创建 → 内部审批 → 供应商确认 → 订单跟踪 → 到货通知 → 收货验收
```

### 质量问题处理流程
```
问题发现 → 问题记录 → 供应商通知 → 原因分析 → 整改措施 → 效果验证
```

## 权限控制

### 采购计划权限
- **查看权限**：采购部门、管理层
- **创建权限**：采购员、采购主管
- **审批权限**：采购主管、采购经理
- **修改权限**：计划创建人（审批前）

### 订单管理权限
- **查看权限**：采购部门、仓库、管理层
- **创建权限**：采购员、采购主管
- **审批权限**：根据金额分级审批
- **变更权限**：采购员申请、主管审批

### 供应商评估权限
- **查看权限**：采购部门、质量部门
- **创建权限**：采购主管、质量主管
- **审核权限**：采购经理、质量经理

### 验收入库权限
- **收货权限**：仓库管理员
- **检验权限**：质量检验员
- **入库权限**：仓库管理员
- **审核权限**：仓库主管
